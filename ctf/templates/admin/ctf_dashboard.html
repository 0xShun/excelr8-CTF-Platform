{% extends 'admin/base_site.html' %}
{% load humanize %}

{% block title %}Competition Dashboard{% endblock %}

{% block extrahead %}
<style>
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #007bff;
        display: block;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .competition-status {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: bold;
    }
    
    .status-active { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-upcoming { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    .status-ended { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    
    .recent-activity {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .activity-item {
        padding: 10px 0;
        border-bottom: 1px solid #eee;
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .correct { color: #28a745; }
    .incorrect { color: #dc3545; }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; Competition Dashboard
</div>
{% endblock %}

{% block content %}
<h1>Competition Dashboard</h1>

<!-- Competition Status -->
<div class="competition-status 
    {% if stats.competition_settings.is_active %}status-active
    {% elif stats.competition_settings.is_upcoming %}status-upcoming  
    {% else %}status-ended{% endif %}">
    
    Competition Status: 
    {% if stats.competition_settings.is_active %}
        üü¢ <strong>ACTIVE</strong> - Competition is currently running
    {% elif stats.competition_settings.is_upcoming %}
        üü° <strong>UPCOMING</strong> - Competition starts {{ stats.competition_settings.start_time|date:"M d, Y H:i" }}
    {% else %}
        üî¥ <strong>ENDED</strong> - Competition ended {{ stats.competition_settings.end_time|date:"M d, Y H:i" }}
    {% endif %}
</div>

<!-- Statistics Cards -->
<div class="dashboard-stats">
    <div class="stat-card">
        <span class="stat-number">{{ stats.total_challenges }}</span>
        <div class="stat-label">Total Challenges</div>
        <small>({{ stats.visible_challenges }} visible)</small>
    </div>
    
    <div class="stat-card">
        <span class="stat-number">{{ stats.total_teams }}</span>
        <div class="stat-label">Active Teams</div>
    </div>
    
    <div class="stat-card">
        <span class="stat-number">{{ stats.total_users }}</span>
        <div class="stat-label">Registered Users</div>
    </div>
    
    <div class="stat-card">
        <span class="stat-number">{{ stats.total_submissions }}</span>
        <div class="stat-label">Total Submissions</div>
        <small>({{ stats.correct_submissions }} correct)</small>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <!-- Challenge Categories -->
    <div class="recent-activity">
        <h3>Challenge Categories</h3>
        {% for category in stats.categories %}
        <div class="activity-item">
            <strong>{{ category.name }}</strong>
            <span style="float: right;">{{ category.challenge_count }} challenge{{ category.challenge_count|pluralize }}</span>
        </div>
        {% empty %}
        <p>No categories created yet.</p>
        {% endfor %}
        
        <a href="{% url 'admin:ctf_category_changelist' %}" class="button" style="margin-top: 10px;">
            Manage Categories
        </a>
    </div>

    <!-- Recent Submissions -->
    <div class="recent-activity">
        <h3>Recent Submissions</h3>
        {% for submission in stats.recent_submissions %}
        <div class="activity-item">
            <strong>{{ submission.user.username }}</strong>
            {% if submission.team %} ({{ submission.team.name }}) {% endif %}
            submitted to <em>{{ submission.challenge.title }}</em>
            <span class="{% if submission.correct %}correct{% else %}incorrect{% endif %}" style="float: right;">
                {% if submission.correct %}‚úì{% else %}‚úó{% endif %}
            </span>
            <br><small>{{ submission.timestamp|timesince }} ago</small>
        </div>
        {% empty %}
        <p>No submissions yet.</p>
        {% endfor %}
        
        <a href="{% url 'admin:ctf_submission_changelist' %}" class="button" style="margin-top: 10px;">
            View All Submissions
        </a>
    </div>
</div>

<!-- Quick Actions -->
<div class="recent-activity" style="margin-top: 20px;">
    <h3>Quick Actions</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
        <a href="{% url 'admin:ctf_competitionsettings_change' stats.competition_settings.pk %}" class="button">
            ‚öôÔ∏è Competition Settings
        </a>
        <a href="{% url 'admin:ctf_challenge_add' %}" class="button">
            ‚ûï Add Challenge  
        </a>
        <a href="{% url 'admin:ctf_category_add' %}" class="button">
            üìÅ Add Category
        </a>
        <a href="{% url 'admin:ctf_team_changelist' %}" class="button">
            üë• Manage Teams
        </a>
        <a href="{% url 'admin:ctf_challenge_changelist' %}" class="button">
            üèÜ View Challenges
        </a>
        <a href="{% url 'admin:ctf_submission_changelist' %}" class="button">
            üìä View Submissions
        </a>
    </div>
</div>

{% endblock %}
